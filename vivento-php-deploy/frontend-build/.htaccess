# Vivento URL Rewriting and Security

# Enable URL rewriting
RewriteEngine On

# Force HTTPS (uncomment when SSL is available)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# API routing - redirect /api/* to PHP files
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/auth/login/?$ api/auth/login.php [L,QSA]
RewriteRule ^api/auth/register/?$ api/auth/register.php [L,QSA]
RewriteRule ^api/events/?$ api/events/index.php [L,QSA]
RewriteRule ^api/events/([^/]+)/?$ api/events/detail.php?id=$1 [L,QSA]
RewriteRule ^api/templates/?$ api/templates/index.php [L,QSA]
RewriteRule ^api/invite/([^/]+)/?$ api/invite/index.php?token=$1 [L,QSA]
RewriteRule ^api/invite/([^/]+)/rsvp/?$ api/invite/rsvp.php?token=$1 [L,QSA]
RewriteRule ^api/upload/?$ api/upload/index.php [L,QSA]

# Invitation routing
RewriteRule ^invite/([^/]+)/?$ invitation.php?token=$1 [L,QSA]

# SPA routing - serve index.html for non-API routes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/uploads/
RewriteRule ^.*$ index.html [L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Cache static assets
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
</FilesMatch>

# Protect sensitive files
<Files "config.php">
    Order allow,deny
    Deny from all
</Files>

<Files "database_setup.sql">
    Order allow,deny
    Deny from all
</Files>

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
